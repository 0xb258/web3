<script setup>
import { ref, onMounted, computed } from 'vue'
import { useRoute } from 'vue-router'
import { useI18n } from 'vue-i18n'
import api from '@/apis'
const { t } = useI18n()
const route = useRoute()
let token = ref(route.query.token)
let tokenType = ref({
	1:'XUSDT',
	2:'XJ',
	3:'XD',
	4:'USDT',
	5:'JU',
	6:'XB'
})
let totalType = ref({
	1:'report_balance',
	2:'x_s_balance',
	3:'x_d_balance',
	4:'usdt_balance',
	5:'ju_balance',
	6:'xb_balance'
})
let actions = ref({
	1:'数据调整',
	2:'提现',
	3:'提现退回',
	4:'购买算力',
	5:'失效退回',
	6:'内部转账',
	7:'小区业绩排行榜分红',
	8:'每日入金排行榜分红',
	9:'静态产出',
	10:'直推产出',
	11:'层级产出',
	12:'团队产出',
	13:'兑换',
	14:'算力产出',
})
let amount_type = ref(tokenType.value[token.value])
let total_type = ref(totalType.value[token.value])



let list = ref([])
let page = ref(1)
let pageSize = ref(10)
let loading = ref(false)
let finished = ref(false)

const loadMore = async () => {
    if (loading.value || finished.value) return
    loading.value = true
    try {
        const res = await api.home.incomeList({
            amount_type: token.value,
            page: page.value,
            page_size: pageSize.value
        })
        const items = res?.list || []
        if (page.value === 1 && list.value.length && items.length) {
            list.value = []
        }
        list.value.push(...items)
        if (!items.length || items.length < pageSize.value) {
            finished.value = true
        } else {
            page.value += 1
        }
    } finally {
        loading.value = false
    }
}

const resetAndReload = () => {
    list.value = []
    page.value = 1
    finished.value = false
    loadMore()
}
let tokens = ref({
	ju_balance: 0.00,
	usdt_balance: 0.00,
	x_s_balance: 0.00,
	x_d_balance: 0.00,
	xb_balance: 0.00,
	report_balance: 0.00,
})
let getToken = async () => {
		const res = await api.home.userInfo()
		tokens.value = res?.balance_list ?? {}
}

onMounted(() => {
    resetAndReload()
    getToken()
})
const handleScroll = (e) => {
    const { scrollTop, scrollHeight: scrollHeightValue, clientHeight: clientHeightValue } = e.target
    if (scrollHeightValue - scrollTop - clientHeightValue < 50) {
        loadMore()
    }
}
</script>
<template>
	<div class="container">
		<div class="body">
			<div class="body_top h-100 mb-20 px-16 pt-[26px] pb-[20px] text-[#fff]">
				<div class="flex items-center justify-between mb-20">
					<div>
						<div class="text-[28px] font-roboto font-700 mb-8">{{ Number(tokens[total_type]||'0.00').toFixed(2) }}</div>
						<div class="text-[12px] font-pingfang">{{ amount_type }} 资产总额</div>
					</div>
				</div>
				<!-- <div class="text-[12px] font-pingfang text-[#fff]">注：全网当天24小时本帐号入金最多的前33名</div> -->
				<!-- <div class="flex items-center justify-between">
					<div
						class="font-roboto font-500 w-50% flex items-center justify-center rounded-[10px] h-52 bg-[#000000] van-haptics-feedback"
						@click='() => handleWithdrawOrRecharge()'>
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
							<g clip-path="url(#clip0_3_596)">
								<path
									d="M1.28844 13.4316C0.922585 13.4316 0.608426 13.2964 0.345964 13.026C0.0835016 12.7556 -0.0477295 12.4374 -0.0477295 12.0716V10.2582C-0.0477295 9.89235 0.0835016 9.57819 0.345964 9.31572C0.608426 9.05326 0.922585 8.92203 1.28844 8.92203H18.8018C18.5632 8.98566 18.3326 9.06917 18.1099 9.17256C17.8872 9.27596 17.6883 9.439 17.5134 9.6617C17.0044 10.2343 16.4953 10.8507 15.9863 11.5109C15.4773 12.171 14.9921 12.8112 14.5308 13.4316H1.28844ZM4.27097 7.39498C3.90511 7.39498 3.59095 7.25977 3.32849 6.98936C3.06603 6.71894 2.93479 6.40081 2.93479 6.03495V4.36474C2.93479 3.99888 3.06603 3.68472 3.32849 3.42226C3.59095 3.1598 3.90511 3.02856 4.27097 3.02856H22.4286C22.7944 3.02856 23.1126 3.1598 23.383 3.42226C23.6534 3.68472 23.7886 3.99888 23.7886 4.36474V6.03495C23.7886 6.40081 23.6534 6.71894 23.383 6.98936C23.1126 7.25977 22.7944 7.39498 22.4286 7.39498H4.27097ZM16.3204 17.8696V18.0605C16.3204 18.1559 16.3243 18.311 16.3323 18.5258C16.3402 18.7405 16.3442 19.0547 16.3442 19.4682H1.28844C0.922585 19.4682 0.608426 19.337 0.345964 19.0745C0.0835016 18.8121 -0.0477295 18.49 -0.0477295 18.1082V16.3187C-0.0477295 15.9528 0.0835016 15.6387 0.345964 15.3762C0.608426 15.1138 0.922585 14.9825 1.28844 14.9825H13.3378C13.2901 15.0143 13.2464 15.0581 13.2066 15.1138C13.1668 15.1694 13.1311 15.2132 13.0992 15.245C12.9402 15.4677 12.8447 15.7301 12.8129 16.0324C12.7811 16.3346 12.8129 16.6249 12.9084 16.9033C13.0038 17.1816 13.1589 17.4163 13.3736 17.6071C13.5884 17.798 13.8548 17.8935 14.1729 17.8935H15.2944L16.3204 17.8696ZM23.4307 15.1973L23.7886 15.7938C23.884 15.9528 23.9318 16.0801 23.9318 16.1755C23.9318 16.271 23.8721 16.3386 23.7528 16.3783C23.6335 16.4181 23.4387 16.438 23.1682 16.438H21.8798C21.5298 16.438 21.2674 16.5255 21.0924 16.7005C20.9174 16.8754 20.8299 17.1061 20.8299 17.3924V19.7068C20.8299 19.9773 20.7106 20.2477 20.472 20.5181C20.2334 20.7885 19.9471 20.9237 19.6131 20.9237H18.6825C18.4439 20.9237 18.2332 20.8322 18.0502 20.6493C17.8673 20.4664 17.7758 20.1443 17.7758 19.683C17.7758 19.4762 17.7798 19.345 17.7878 19.2893C17.7957 19.2336 17.7997 19.162 17.7997 19.0745C17.7997 18.9871 17.8037 18.8399 17.8116 18.6331C17.8196 18.4263 17.8236 18.0684 17.8236 17.5594C17.8236 17.1618 17.756 16.8754 17.6207 16.7005C17.4855 16.5255 17.243 16.438 16.893 16.438H15.6046C15.2387 16.438 15.0081 16.3624 14.9126 16.2113C14.8172 16.0602 14.8967 15.8256 15.1512 15.5074C15.3898 15.1893 15.6563 14.8195 15.9505 14.3979C16.2448 13.9764 16.547 13.539 16.8572 13.0856C17.1674 12.6323 17.4696 12.1909 17.7639 11.7614C18.0582 11.3319 18.3405 10.9501 18.6109 10.6161C18.7223 10.4889 18.8654 10.3894 19.0404 10.3179C19.2154 10.2463 19.3983 10.2065 19.5892 10.1986C19.7801 10.1906 19.9551 10.2105 20.1141 10.2582C20.2732 10.3059 20.3925 10.3855 20.472 10.4968C20.6629 10.8308 20.8816 11.2007 21.1282 11.6063C21.3747 12.0119 21.6332 12.4215 21.9036 12.8351C22.1741 13.2487 22.4405 13.6583 22.703 14.0639C22.9654 14.4695 23.208 14.8473 23.4307 15.1973Z"
									fill="white" />
								<path
									d="M23.4308 15.1972L23.7887 15.7937C23.8842 15.9528 23.9319 16.0801 23.9319 16.1755C23.9319 16.2709 23.8722 16.3385 23.7529 16.3783C23.6336 16.4181 23.4388 16.438 23.1684 16.438H21.8799C21.53 16.438 21.2675 16.5254 21.0925 16.7004C20.9175 16.8754 20.8301 17.106 20.8301 17.3924V19.7068C20.8301 19.9772 20.7108 20.2476 20.4722 20.5181C20.2336 20.7885 19.9472 20.9237 19.6132 20.9237H18.6826C18.444 20.9237 18.2333 20.8322 18.0503 20.6493C17.8674 20.4664 17.776 20.1442 17.776 19.6829C17.776 19.4762 17.7799 19.3449 17.7879 19.2893C17.7958 19.2336 17.7998 19.162 17.7998 19.0745C17.7998 18.987 17.8038 18.8399 17.8117 18.6331C17.8197 18.4263 17.8237 18.0684 17.8237 17.5594C17.8237 17.1617 17.7561 16.8754 17.6209 16.7004C17.4857 16.5254 17.2431 16.438 16.8931 16.438H15.6047C15.2388 16.438 15.0082 16.3624 14.9127 16.2113C14.8173 16.0602 14.8968 15.8255 15.1513 15.5074C15.3899 15.1893 15.6564 14.8194 15.9506 14.3979C16.2449 13.9764 16.5472 13.5389 16.8573 13.0856C17.1675 12.6323 17.4697 12.1908 17.764 11.7614C18.0583 11.3319 18.3406 10.9501 18.6111 10.6161C18.7224 10.4888 18.8656 10.3894 19.0405 10.3178C19.2155 10.2462 19.3984 10.2065 19.5893 10.1985C19.7802 10.1906 19.9552 10.2104 20.1143 10.2582C20.2733 10.3059 20.3926 10.3854 20.4722 10.4968C20.663 10.8308 20.8818 11.2006 21.1283 11.6063C21.3749 12.0119 21.6334 12.4215 21.9038 12.8351C22.1742 13.2486 22.4406 13.6582 22.7031 14.0639C22.9655 14.4695 23.2081 14.8473 23.4308 15.1972Z"
									fill="#19A55F" />
							</g>
							<defs>
								<clipPath id="clip0_3_596">
									<rect width="24" height="24" fill="white" />
								</clipPath>
							</defs>
						</svg>
						<div class="ml-10">提现</div>
					</div>
					<div
						class="font-roboto font-500 w-50% flex items-center justify-center rounded-[10px] h-52 bg-[#00C18D] ml-10 van-haptics-feedback"
						@click='() => handleWithdrawOrRecharge(false)'>
						<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25" fill="none">
							<g clip-path="url(#clip0_3_605)">
								<path
									d="M1.78399 13.7941C1.42357 13.7941 1.11947 13.6702 0.871681 13.4224C0.623894 13.1746 0.5 12.863 0.5 12.4876V10.7981C0.5 10.4527 0.623894 10.1524 0.871681 9.89709C1.11947 9.6418 1.42357 9.51415 1.78399 9.51415H18.2956C18.4158 9.51415 18.5359 9.53667 18.6561 9.58173C18.0554 9.65681 17.4809 9.81074 16.9328 10.0435C16.3847 10.2763 15.8853 10.5766 15.4348 10.9446C14.9843 11.3125 14.5901 11.7405 14.2522 12.2285C13.9143 12.7166 13.6477 13.2385 13.4525 13.7941H1.78399ZM13.1146 15.2358C13.0996 15.3559 13.0921 15.4686 13.0921 15.5737V15.889C13.0921 16.5648 13.1897 17.2031 13.3849 17.8038C13.5802 18.4045 13.8505 18.9601 14.1959 19.4707H1.78399C1.42357 19.4707 1.11947 19.3468 0.871681 19.099C0.623894 18.8512 0.5 18.5471 0.5 18.1867V16.4972C0.5 16.1518 0.623894 15.8553 0.871681 15.6075C1.11947 15.3597 1.42357 15.2358 1.78399 15.2358H13.1146ZM4.57723 8.095C4.23183 8.095 3.93523 7.97111 3.68745 7.72332C3.43966 7.47553 3.31577 7.17143 3.31577 6.81101V5.25671C3.31577 4.89629 3.43966 4.58844 3.68745 4.33314C3.93523 4.07784 4.23183 3.9502 4.57723 3.9502H21.7196C22.065 3.9502 22.3616 4.07784 22.6094 4.33314C22.8572 4.58844 22.9811 4.89629 22.9811 5.25671V6.81101C22.9811 7.17143 22.8572 7.47553 22.6094 7.72332C22.3616 7.97111 22.065 8.095 21.7196 8.095H4.57723ZM19.5346 10.9783C20.2104 10.9783 20.8486 11.1097 21.4493 11.3726C22.05 11.6354 22.5756 11.9883 23.0261 12.4313C23.4766 12.8743 23.8333 13.3962 24.0961 13.9968C24.3589 14.5975 24.4903 15.2358 24.4903 15.9116C24.4903 16.6024 24.3589 17.2481 24.0961 17.8488C23.8333 18.4495 23.4766 18.9751 23.0261 19.4256C22.5756 19.8762 22.05 20.2291 21.4493 20.4844C20.8486 20.7397 20.2104 20.8673 19.5346 20.8673C18.8588 20.8673 18.2206 20.7397 17.6199 20.4844C17.0192 20.2291 16.4935 19.8762 16.043 19.4256C15.5925 18.9751 15.2358 18.4495 14.973 17.8488C14.7102 17.2481 14.5788 16.6024 14.5788 15.9116C14.5788 15.2358 14.7102 14.5975 14.973 13.9968C15.2358 13.3962 15.5925 12.8743 16.043 12.4313C16.4935 11.9883 17.0192 11.6354 17.6199 11.3726C18.2206 11.1097 18.8588 10.9783 19.5346 10.9783ZM22.3278 16.7225C22.478 16.7225 22.6019 16.6437 22.6995 16.486C22.7971 16.3283 22.8459 16.1443 22.8459 15.9341C22.8459 15.7238 22.7971 15.5474 22.6995 15.4047C22.6019 15.2621 22.478 15.1907 22.3278 15.1907H20.2104V13.2084C20.2104 13.0883 20.1465 12.9832 20.0189 12.8931C19.8912 12.803 19.7148 12.7579 19.4895 12.7579C19.2492 12.7579 19.0728 12.803 18.9602 12.8931C18.8475 12.9832 18.7912 13.0883 18.7912 13.2084V15.6863C18.7912 15.7314 18.7875 15.7727 18.7799 15.8102C18.7724 15.8477 18.7687 15.889 18.7687 15.9341C18.7687 16.1443 18.8175 16.3283 18.9151 16.486C19.0127 16.6437 19.1366 16.7225 19.2868 16.7225H22.3278Z"
									fill="white" />
								<path
									d="M19.5346 10.9784C20.2104 10.9784 20.8486 11.1098 21.4493 11.3726C22.05 11.6354 22.5756 11.9883 23.0261 12.4313C23.4766 12.8744 23.8333 13.3962 24.0961 13.9969C24.3589 14.5976 24.4903 15.2359 24.4903 15.9116C24.4903 16.6024 24.3589 17.2482 24.0961 17.8489C23.8333 18.4496 23.4766 18.9752 23.0261 19.4257C22.5756 19.8762 22.05 20.2291 21.4493 20.4844C20.8486 20.7397 20.2104 20.8674 19.5346 20.8674C18.8588 20.8674 18.2205 20.7397 17.6199 20.4844C17.0192 20.2291 16.4935 19.8762 16.043 19.4257C15.5925 18.9752 15.2358 18.4496 14.973 17.8489C14.7102 17.2482 14.5788 16.6024 14.5788 15.9116C14.5788 15.2359 14.7102 14.5976 14.973 13.9969C15.2358 13.3962 15.5925 12.8744 16.043 12.4313C16.4935 11.9883 17.0192 11.6354 17.6199 11.3726C18.2205 11.1098 18.8588 10.9784 19.5346 10.9784ZM22.3278 16.7226C22.478 16.7226 22.6019 16.6437 22.6995 16.4861C22.7971 16.3284 22.8459 16.1444 22.8459 15.9342C22.8459 15.7239 22.7971 15.5475 22.6995 15.4048C22.6019 15.2621 22.478 15.1908 22.3278 15.1908H20.2104V13.2085C20.2104 13.0884 20.1465 12.9832 20.0189 12.8931C19.8912 12.803 19.7148 12.758 19.4895 12.758C19.2492 12.758 19.0728 12.803 18.9602 12.8931C18.8475 12.9832 18.7912 13.0884 18.7912 13.2085V15.6864C18.7912 15.7314 18.7875 15.7727 18.7799 15.8103C18.7724 15.8478 18.7687 15.8891 18.7687 15.9342C18.7687 16.1444 18.8175 16.3284 18.9151 16.4861C19.0127 16.6437 19.1366 16.7226 19.2868 16.7226H22.3278Z"
									fill="white" />
							</g>
							<defs>
								<clipPath id="clip0_3_605">
									<rect width="24" height="24" fill="white" transform="translate(0.5 0.375)" />
								</clipPath>
							</defs>
						</svg>
						<div class="ml-10">充值</div>
					</div>
				</div> -->
			</div>
            <div class="body_content px-15">
                <div class="scroll-box" @scroll.passive="handleScroll">
                <div class="mb-[10px] h-[64px] rounded-[6px] px-[14px] bg-[#F5F8F8] flex items-center justify-between"
                    v-for="(item, index) in list" :key="item.id || index">
					<div class="flex items-center">
						<div class="content ml-10">
							<div class="text-[16px] text-[#000]">{{ actions[item.type] }}</div>
							<div class="text-[10px] text-[#8F8F8F] mt-[10px]">{{ item.created_at }}</div>
						</div>
					</div>
					<div>{{ Number(item?.total ||0).toFixed(2) }}</div>
				</div>
                <div class="py-12 text-center text-[#999] text-[12px]" v-if="loading">加载中...</div>
                <div class="py-12 text-center text-[#999] text-[12px]" v-else-if="finished && list.length">没有更多数据了</div>
                <div class="flex items-center justify-center mt-20" v-if="!list.length && !loading">
					<van-empty image="https://fastly.jsdelivr.net/npm/@vant/assets/custom-empty-image.png" image-size="80"
						description="暂无数据" />
				</div>
                </div>
			</div>
		</div>
	</div>
</template>
<style lang="scss" scoped>
.container {
	width: 100%;
}

.body {
	width: 100%;
	min-height: calc(100vh - var(--van-nav-bar-height) - 28px);

	&_top {
		background: linear-gradient(192deg, #191D1C 30.36%, #237D4E 90.99%);

		&__content {}
	}
}


.scroll-box {
  max-height: 76vh;
  overflow-y: auto;
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE/Edge */
}
.scroll-box::-webkit-scrollbar {
  width: 0;
  height: 0;
  display: none;
}
/* 去除底部留白 */
.scroll-box {
  padding-bottom: 0;
}
.scroll-box > div:last-child {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}
.custom-indicator {
	position: absolute;
	left: 25px;
	bottom: 12px;
	padding: 2px 5px;
	font-size: 12px;
	background: rgba(0, 0, 0, 0.1);
}

.img {
	width: 60px;
	height: 38px;
	img{
		width: 100%;
		height: 100%;
	}
}

.border-D9 {
	border: 1px solid #D9D9D9;
}
</style>
